<!DOCTYPE html>
<html>
    
    <head>
        <style type="text/css">
            html, body { height: 100%; margin: 0; padding: 0; }
            #map { height: 50%; }
        </style>
        <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <script>
            //Used to login returning users
            function login(email, password) {
                mRef.authWithPassword({
                    email   : email,
                    password: password
                }, function(error, authData) {
                if(error) {
                    console.log("Login Failed!", error);
                } else {
                    console.log("Authenticated successfully with payload:", authData)
                }
            });
                
            }
            
            //Used when creating new users
            function createAccount(email, password, name) {
                var success = false;
                mRef.createUser({
                    email: email,
                    password: password
                }, function(error, userData) {
                    if (error) {
                        switch (error.code) {
                            case "EMAIL_TAKEN":
                                console.log("The new user account cannot be created because the email is already in use.");
                                break;
                            case "INVALID_EMAIL":
                                console.log("The specified email is not a valid email.");
                                break;
                            default:
                                console.log("Error creating user:", error);
                            }
                    } else {
                        console.log("Successfully created user account with uid:", userData.uid);
                        successCreated();
                        
                    }
                });
                function successCreated() {
                    mRef.child("Users").push({
                        EmailAddress: email,
                        Name: name
                    });
                }
                
            }
            
            //Create a map centered on US with some stylers
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 39.887, lng: -96.437},
                    zoom: 5,
                    styles: [{
                        featureType: 'poi',
                        stylers: [{ visibility: 'off' }]  // Turn off points of interest.
                    }, {
                        featureType: 'transit.station',
                        stylers: [{ visibility: 'off' }]  // Turn off bus stations, train stations, etc.
                    }]
                });
            }
            
            //Take in an event name to put all of its members addresses and its own address on map
            function displayMap(eventName) {
                mRef.once("value", function(snap) {
                    var obj = snap.val();
                    
                    for(var i in obj["Events"]) {
                        if(obj["Events"][i]["Event"] == eventName) {
                            var latLng = new google.maps.LatLng(obj["Events"][i]["Lat"], obj["Events"][i]["Lng"]);
                                    
                            var marker = new google.maps.Marker({
                                map: map,
                                position: latLng,
                                title: eventName,
                                icon: {
                                    path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
                                    scale: 5
                                }
                            });
                            for(var j in obj["Events"][i]) {
                                var address = obj["Events"][i][j]["Address"];
                                if(address != null) {
                                    
                                    var latLng = new google.maps.LatLng(obj["Events"][i][j]["Lat"], obj["Events"][i][j]["Lng"]);
                                    
                                    var marker = new google.maps.Marker({
                                        map: map,
                                        position: latLng,
                                        title: obj["Events"][i][j]["Name"]
                                    });
                                }
                                else {
                                    //alert(address);
                                }
                            }
                        }
                    }
                });
            }
            
            //return a latLng for address
            function codeAddress(address) {
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode( { 'address': address}, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        return results[0].geometry.location;
                        console.log(address);
                    } else {
                        alert("Geocode was not successful for the following reason: " + status);
                    }
                });
            }
            
            //var mRef = new Firebase("https://glaring-inferno-647.firebaseio.com/");
            var mRef = new Firebase("https://hackathondrive.firebaseio.com/");
            var map;
            
            //createAccount('qhuyett@gmail.com', 'easy123', 'Quentin Huyett');
            //login('qhuyett1@umbc.edu', 'easy123');
            displayMap("EagleHacks");
        
        </script>
        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPuhAA-CpEQ6g9BuOJxg1tfe5PF9BjmXc&libraries=visualization&callback=initMap">
        </script>
    </body>
</html>