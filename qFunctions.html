<!DOCTYPE html>
<html>
    
    <head>
        <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
        <style type="text/css">
            html, body { height: 100%; margin: 0; padding: 0; }
            #map { height: 50%; }
        </style>
        <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <script>
            
            
            //Create a map centered on US with some stylers
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 39.887, lng: -96.437},
                    zoom: 5,
                    styles: [{
                        featureType: 'poi',
                        stylers: [{ visibility: 'off' }]  // Turn off points of interest.
                    }, {
                        featureType: 'transit.station',
                        stylers: [{ visibility: 'off' }]  // Turn off bus stations, train stations, etc.
                    }]
                });
            }
            
            //Take in an event name to put all of its members markers and its own marker on map
            function displayMapOfEvent(eventName) {
                mRef.once("value", function(snap) {
                    var obj = snap.val();
                    
                    for(var i in obj["Events"]) {
                        if(obj["Events"][i]["Event"] == eventName) {
                            var latLng = new google.maps.LatLng(obj["Events"][i]["Lat"], obj["Events"][i]["Lng"]);
                                    
                            var marker = new google.maps.Marker({
                                map: map,
                                position: latLng,
                                title: eventName,
                                icon: {
                                    path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
                                    scale: 5,
                                    fillColor: 'gold',
                                    fillOpacity: 1,
                                }
                            });
                            
                            var contentString = '<div class = "w3-container w3-padding w3-center">' +
                                '<h2>' + obj["Events"][i]["Event"] + '</h2>'+
                                '<p>' + obj["Events"][i]["Address"] + '</p>' +
                                '<p>' + obj["Events"][i]["Month"] + ' ' +
                                obj["Events"][i]["Day"] + ', ' +
                                obj["Events"][i]["Year"] + '</p>' +
                                '</div>';
    
                            var info = new google.maps.InfoWindow({
                                content: contentString
                            });
                            
                            marker.addListener('mouseover', function() {
                                info.open(map,marker);
                            });
                            marker.addListener('mouseout', function() {
                                info.close(map,marker);
                            });
                            
                            for(var j in obj["Events"][i]) {
                                var address = obj["Events"][i][j]["Address"];
                                if(address != null) {
                                    var latLng = new google.maps.LatLng(obj["Events"][i][j]["Lat"], obj["Events"][i][j]["Lng"]);
                                    
                                    var marker = new google.maps.Marker({
                                        map: map,
                                        position: latLng,
                                        title: obj["Events"][i][j]["Name"],
                                    });
                                     
                                    var contentString = '<div class = "w3-container w3-padding w3-center">' +
                                        '<p>' + obj["Events"][i][j]["Name"] + '</p>' +
                                        '<p>' + obj["Events"][i][j]["EmailAddress"] + '</p>' +
                                        '<p>' + obj["Events"][i][j]["Address"] + '</p>' +
                                        '</div>';
    
                                    var info = new google.maps.InfoWindow({
                                        content: contentString
                                    });
                            
                                    marker.addListener('mouseover', function() {
                                        info.open(map,marker);
                                    });
                                    marker.addListener('mouseout', function() {
                                        info.close(map,marker);
                                    });
                                }
                            }
                        }
                    }
                });
            }
            
            //return a latLng for address
            function codeAddress(address) {
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode( { 'address': address}, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        return results[0].geometry.location;
                        console.log(address);
                    } else {
                        alert("Geocode was not successful for the following reason: " + status);
                    }
                });
            }
            
            //var mRef = new Firebase("https://glaring-inferno-647.firebaseio.com/");
            var mRef = new Firebase("https://hackathondrive.firebaseio.com/");
            var map;
            
            //createAccount('qhuyett@gmail.com', 'easy123', 'Quentin Huyett');
            //login('qhuyett1@umbc.edu', 'easy123');
            displayMapOfEvent("EagleHacks");
        
        </script>
        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPuhAA-CpEQ6g9BuOJxg1tfe5PF9BjmXc&libraries=visualization&callback=initMap">
        </script>
        <script src="authFunctions.js"></script>
    </body>
</html>